variables:
   MSBUILD_PATH: 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\msbuild.exe'
   NUGET_PATH: 'C:\NuGet\nuget.exe'
   MSTEST_PATH: 'C:\Program Files\Microsoft Visual Studio\2022\Community\Common7\IDE\mstest.exe'
   TEST_FOLDER: '.\src\AcelistUnitTest\bin\Release'
 
stages:
  - build
  - test
 
build_job:
  stage: build
  tags:
    - testss
  script:
    - '& "$env:MSBUILD_PATH" ".\src\Acelist.sln" /p:Configuration=Release'
  artifacts:
    expire_in: 2 days
    paths:
      - '.\src\Acelist\bin\Release\'
      - '$env:TEST_FOLDER'
      - '.\$env:MSTEST_PATH\*.*'
  allow_failure:
    exit_codes: 2

test_job:
  stage: test
  tags:
    - testss
  script:
    - .\src\AcelistUnitTest\AcelistUnitTest.bat
  dependencies:
    - "build_job"